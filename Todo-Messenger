from datetime import datetime
import json

tasks = []
while_bool = True

def load_tasks():
    global tasks
    try:
        with open("tasks.json", "r") as file:
            tasks = json.load(file)
    except FileNotFoundError:
        tasks = []
        with open("tasks.json", "w") as file:
            json.dump(tasks, file)
            print("файл не найден, создан новый")


def save_tasks(tasks):
    with open("tasks.json", "w") as file:
        json.dump(tasks, file, indent=4, ensure_ascii=False)

def add_task():
    global tasks
    create_time = datetime.now().strftime("%d.%m.%Y %H:%M")
    text_input = input("Введите текст: ")
    full_task = {
        "text": text_input,
        "created": create_time,
        "done": False
    }
    tasks.append(full_task)
    save_tasks(tasks)
    print("Задача добавлена")

def show_tasks():
    if not tasks:
        print("Список задач пуст")
        return
    print("------------------------------------------------")
    for i, task in enumerate(tasks, 1):
        status = "✓" if task["done"] else ""
        print(f"{i}. [{status}] {task['text']} | {task['created']}")
    print("------------------------------------------------")

def delete_task():
    show_tasks()
    num_is_del = input("Введите номер который хотите удалить: ")
    num_is_del = num_is_del.strip()
    if num_is_del.isdigit():
        num_is_del = int(num_is_del)
        if 1 <= num_is_del <= len(tasks):
            removed = tasks.pop(num_is_del - 1)
            print(f"Удалена задача: {removed}")
        else:
            print("Ошибка: такого номера нет в списке")
    else:
        print("Ошибка: введите число")
    save_tasks(tasks)

def mark_done():

    show_tasks()
    num = input("Введите номер выполненной задачи: ").strip()
    if num.isdigit():
        num = int(num)
        if 1 <= num <= len(tasks):
            tasks[num-1]["done"] = True
            show_tasks()
            print("Задача отмечена как выполненная")
        else:
            print("Нет такого номера")
    else:
        print("Введите число")

def menu_task():
    try:
        print("1. Добавить задачу\n"
            "2. Удалить задачу\n"
            "3. Посмотреть задачи\n"
            "4. Пометить задачу выполненой\n"
            "5. Выйти")
        num_menu = int(input("В ведите действие: "))
        if num_menu == 1:
            add_task()
            return True
        elif num_menu == 2:
            delete_task()
            return True
        elif num_menu == 3:
            show_tasks()
            return True
        elif num_menu == 4:
            mark_done()
            return True
        elif num_menu == 5:
            return False
    except ValueError:
        print("Вы ввели не число")


load_tasks()
while while_bool:
    while_bool = menu_task()
